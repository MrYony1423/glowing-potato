
<html lang="he">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IkOk - אפליקציה כמו טיקטוק</title>
<style>
  /* --- עיצוב בסיסי ונקי --- */
  body, html {
    margin:0; padding:0;
    background:#000;
    color:#fff;
    font-family: Arial, sans-serif;
    display: flex; flex-direction: column; align-items: center;
  }
  h1 {
    margin: 20px;
  }
  #auth, #upload-section, #video-feed {
    width: 95vw; max-width: 600px;
  }
  input, button, textarea {
    width: 100%;
    margin: 8px 0;
    padding: 10px;
    font-size: 1rem;
    border-radius: 6px;
    border: none;
  }
  button {
    background: #ff0040;
    color: white;
    font-weight: bold;
    cursor: pointer;
  }
  button:disabled {
    background: #666;
    cursor: not-allowed;
  }
  #video-feed {
    margin-top: 20px;
  }
  .video-item {
    margin-bottom: 30px;
    border-bottom: 1px solid #333;
    padding-bottom: 20px;
  }
  video {
    width: 100%;
    max-height: 400px;
    border-radius: 12px;
    background: black;
  }
  .video-desc {
    margin: 10px 0;
  }
  .actions {
    display: flex; gap: 20px;
  }
  .like-btn, .comment-btn {
    background: none;
    border: none;
    color: #ff0040;
    font-size: 1.3rem;
    cursor: pointer;
  }
  .comments {
    margin-top: 10px;
    font-size: 0.9rem;
    color: #bbb;
  }
  .comment-input-container {
    display: flex;
    gap: 10px;
    margin-top: 10px;
  }
  .comment-input-container input {
    flex-grow: 1;
  }
</style>
</head>
<body>

<h1>IkOk - טיקטוק קלון מושקע</h1>

<!-- התחברות והרשמה -->
<div id="auth">
  <input id="email" type="email" placeholder="אימייל" />
  <input id="password" type="password" placeholder="סיסמה" />
  <button id="signupBtn">הרשמה</button>
  <button id="loginBtn">התחברות</button>
</div>

<!-- העלאת סרטון -->
<div id="upload-section" style="display:none;">
  <input type="file" id="videoFile" accept="video/*" />
  <textarea id="videoDesc" placeholder="תיאור הסרטון (אופציונלי)"></textarea>
  <button id="uploadBtn" disabled>העלה סרטון</button>
  <button id="logoutBtn" style="background:#900;">התנתק</button>
</div>

<!-- הזרמת סרטונים -->
<div id="video-feed"></div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  // --- הכנס כאן את פרטי Firebase שלך ---
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  // אתחול Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  // אלמנטים
  const authDiv = document.getElementById('auth');
  const uploadSection = document.getElementById('upload-section');
  const videoFeed = document.getElementById('video-feed');
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const signupBtn = document.getElementById('signupBtn');
  const loginBtn = document.getElementById('loginBtn');
  const uploadBtn = document.getElementById('uploadBtn');
  const videoFileInput = document.getElementById('videoFile');
  const videoDescInput = document.getElementById('videoDesc');
  const logoutBtn = document.getElementById('logoutBtn');

  // מאפשר העלאה רק כשיש קובץ
  videoFileInput.addEventListener('change', () => {
    uploadBtn.disabled = !videoFileInput.files.length;
  });

  // הרשמה
  signupBtn.onclick = () => {
    const email = emailInput.value.trim();
    const password = passwordInput.value.trim();
    if (!email || !password) return alert('מלא אימייל וסיסמה');
    auth.createUserWithEmailAndPassword(email, password)
      .then(() => alert('נרשמת בהצלחה!'))
      .catch(e => alert(e.message));
  };

  // התחברות
  loginBtn.onclick = () => {
    const email = emailInput.value.trim();
    const password = passwordInput.value.trim();
    if (!email || !password) return alert('מלא אימייל וסיסמה');
    auth.signInWithEmailAndPassword(email, password)
      .then(() => alert('התחברת בהצלחה!'))
      .catch(e => alert(e.message));
  };

  // התנתקות
  logoutBtn.onclick = () => {
    auth.signOut().then(() => alert('התנתקת'));
  };

  // העלאת סרטון
  uploadBtn.onclick = async () => {
    const file = videoFileInput.files[0];
    if (!file) return alert('בחר סרטון');

    uploadBtn.disabled = true;
    uploadBtn.textContent = 'מעלה...';

    try {
      const user = auth.currentUser;
      if (!user) throw new Error('אתה חייב להיות מחובר');

      // שם ייחודי לקובץ
      const fileName = user.uid + '_' + Date.now() + '_' + file.name;
      const storageRef = storage.ref('videos/' + fileName);

      // העלאה ל-Firebase Storage
      await storageRef.put(file);

      // קבלת URL לצפייה
      const url = await storageRef.getDownloadURL();

      // שמירת הסרטון במסד Firestore
      await db.collection('videos').add({
        url,
        description: videoDescInput.value.trim(),
        userId: user.uid,
        userEmail: user.email,
        likes: 0,
        comments: [],
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      alert('הסרטון עלה בהצלחה!');
      videoFileInput.value = '';
      videoDescInput.value = '';
      uploadBtn.disabled = true;
      loadVideos();

    } catch (e) {
      alert('שגיאה: ' + e.message);
    } finally {
      uploadBtn.textContent = 'העלה סרטון';
      uploadBtn.disabled = false;
    }
  };

  // טעינת סרטונים מהמסד והצגה
  function loadVideos() {
    videoFeed.innerHTML = '';
    db.collection('videos')
      .orderBy('createdAt', 'desc')
      .onSnapshot(snapshot => {
        videoFeed.innerHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();

          // קונטיינר לכל סרטון
          const videoItem = document.createElement('div');
          videoItem.className = 'video-item';

          // סרטון
          const videoEl = document.createElement('video');
          videoEl.src = data.url;
          videoEl.controls = true;

          // תיאור
          const desc = document.createElement('p');
          desc.className = 'video-desc';
          desc.textContent = data.description || '(ללא תיאור)';

          // כפתורי לייק ותגובות
          const actions = document.createElement('div');
          actions.className = 'actions';

          // כפתור לייק
          const likeBtn = document.createElement('button');
          likeBtn.className = 'like-btn';
          likeBtn.textContent = `❤️ ${data.likes}`;
          likeBtn.onclick = () => {
            db.collection('videos').doc(doc.id).update({
              likes: firebase.firestore.FieldValue.increment(1)
            });
          };

          actions.appendChild(likeBtn);

          // תגובות
          const commentsDiv = document.createElement('div');
          commentsDiv.className = 'comments';

          if (data.comments && data.comments.length) {
            data.comments.forEach(c => {
              const cP = document.createElement('p');
              cP.textContent = `${c.userEmail}: ${c.text}`;
              commentsDiv.appendChild(cP);
            });
          }

          // אזור לכתיבת תגובה חדשה
          const commentInputContainer = document.createElement('div');
          commentInputContainer.className = 'comment-input-container';

          const commentInput = document.createElement('input');
          commentInput.placeholder = 'כתוב תגובה...';

          const commentBtn = document.createElement('button');
          commentBtn.className = 'comment-btn';
          commentBtn.textContent = 'שלח';

          commentBtn.onclick = () => {
            const user = auth.currentUser;
            if (!user) return alert('אתה חייב להתחבר כדי להגיב');

            const text = commentInput.value.trim();
            if (!text) return alert('כתוב תגובה');

            db.collection('videos').doc(doc.id).update({
              comments: firebase.firestore.FieldValue.arrayUnion({
                userEmail: user.email,
                text
              })
            });

            commentInput.value = '';
          };

          commentInputContainer.appendChild(commentInput);
          commentInputContainer.appendChild(commentBtn);

          videoItem.appendChild(videoEl);
          videoItem.appendChild(desc);
          videoItem.appendChild(actions);
          videoItem.appendChild(commentsDiv);
          videoItem.appendChild(commentInputContainer);

          videoFeed.appendChild(videoItem);
        });
      });
  }

  // מאזין למצב התחברות
  auth.onAuthStateChanged(user => {
    if (user) {
      authDiv.style.display = 'none';
      uploadSection.style.display = 'block';
      loadVideos();
    } else {
      authDiv.style.display = 'block';
      uploadSection.style.display = 'none';
      videoFeed.innerHTML = '';
    }
  });
</script>

</body>
</html>
